<!DOCTYPE html>
<html>
<head>
    <title>Last Minute Trips</title>
    <link rel="icon" href="static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            position: relative;
            height: 200px; /* Adjust as needed */
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Last Minute Trips</h1>
    <nav>
        <div class="nav-wrapper">
            <ul id="nav-mobile" class="right">
                <li><a href="/trips">Home</a></li>
                <li><a href="/subscribe">Subscribe</a></li>
                <li><a href="/empty-trips">Empty Trips</a></li>
                <li><a href="/logout">Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="row">
        <form action="/trips" method="get">
            <div class="input-field col s12 m6">
                <select name="country">
                    <option value="" selected>All countries</option>
                    <option value="Grecja">Greece</option>
                    <option value="Czarnogóra">Montenegro</option>
                    <option value="Chorwacja">Croatia</option>
                    <option value="Bułgaria">Bulgaria</option>
                    <option value="Albania">Albania</option>
                    <option value="Turcja">Turkey</option>
                </select>
                <label>Country</label>
            </div>
            <div class="input-field col s12 m6">
                <select name="persons">
                    <option value="" selected>All person options</option>
                    <option value="2+0">2 adults, 0 children</option>
                    <option value="2+2">2 adults, 2 children</option>
                </select>
                <label>Persons</label>
            </div>
            <div class="input-field col s12">
                <button class="btn waves-effect waves-light" type="submit">Filter</button>
            </div>
        </form>
    </div>

    <table>
        <thead>
        <tr>
            <th>Hotel name</th>
            <th>Type + Location</th>
            <th>Date + length</th>
            <th>Price</th>
            <th>Last Price</th>
            <th>Departure Location</th>
            <th>Food</th>
            <th>Persons</th>
            <th>Price History</th>
        </tr>
        </thead>
        <tbody>
        {% for trip in trips %}
            <tr>
                <td><a href="{{ trip.trip_url }}" target="_blank">{{ trip.title }}</a></td>
                <td>{{ trip.location }}</td>
                <td>{{ trip.days }}</td>
                <td style="color: {% if trip.price < trip.last_price %}green{% elif trip.price > trip.last_price %}red{% endif %}; font-weight: {% if trip.price != trip.last_price %}bold{% endif %}">{{ trip.price }}</td>
                <td>{{ trip.last_price }}</td>
                <td>{{ trip.departure_location }}</td>
                <td>{{ trip.food }}</td>
                <td>{{ trip.persons }}</td>
                <td>
                    <div class="chart-container">
                        <canvas id="chart-{{ trip.id }}"></canvas>
                    </div>
                    <script>
                        var ctx = document.getElementById('chart-{{ trip.id }}').getContext('2d');
                        new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: [{% for point in trip.price_history %}"{{ point[0] }}",{% endfor %}],
                                datasets: [{
                                    label: 'Price History',
                                    data: [{% for point in trip.price_history %}{{ point[1] }},{% endfor %}],
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1,
                                    fill: false
                                }]
                            },
                            options: {
                                scales: {
                                    x: {
                                        type: 'time',
                                        time: {
                                            unit: 'day'
                                        }
                                    },
                                    y: {
                                        beginAtZero: false
                                    }
                                }
                            }
                        });
                    </script>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
    $(document).ready(function () {
        $('select').formSelect();
    });
</script>
</body>
</html>
